% Nystrom on CPU
% Rank = 5000

% Data file (inline table with fake values)
\pgfplotstableread[col sep=comma]{plots/data/nystrom_cpu_5000.csv}\datafile


\begin{tikzpicture}
 \begin{axis}[\nystromCPUrankFiveTall
    after end axis/.code={ % draw after axis so it doesn't get clipped
      \node(A14) at (axis cs:Algo-\algoa-\proca,0) {};
      \node(A24) at (axis cs:Algo-\algob-\proca,0) {};
      \node(A18) at (axis cs:Algo-\algoa-\procb,0) {};
      \node(A28) at (axis cs:Algo-\algob-\procb,0) {};
      \node(A116) at (axis cs:Algo-\algoa-\procc,0) {};
      \node(A216) at (axis cs:Algo-\algob-\procc,0) {};
      \node(A132) at (axis cs:Algo-\algoa-\procd,0) {};
      \node(A232) at (axis cs:Algo-\algob-\procd,0) {};
      \node(A164) at (axis cs:Algo-\algoa-\proce,0) {};
      \node(A264) at (axis cs:Algo-\algob-\proce,0) {};
      \node(A1128) at (axis cs:Algo-\algoa-\procf,0) {};
      \node(A2128) at (axis cs:Algo-\algob-\procf,0) {};
      \node[yshift=-35, xshift=-5] at (A24) {\scriptsize $4$};
      \node[yshift=-35, xshift=-5] at (A28) {\scriptsize $8$};
      \node[yshift=-35, xshift=-5] at (A216) {\scriptsize $16$};
      \node[yshift=-35, xshift=-5] at (A232) {\scriptsize $32$};
      \node[yshift=-35, xshift=-5] at (A264) {\scriptsize $64$};
      \node[yshift=-35, xshift=-5] at (A2128) {\scriptsize $128$};
      % \node[anchor=south] at (axis cs:old-\mb-\pga,151) {$\vdots$};
    },
    x tick label style={font=\scriptsize},
    y tick label style={font=\scriptsize,/pgf/number format/fixed,/pgf/number format/precision=2},
        grid=both,
    major grid style={line width=0.8pt, draw=gray!50},
     minor grid style={line width=0.4pt, draw=gray!20},
    minor tick num=5
    ]
    \pgfplotsset{cycle list={black, fill=color3 \\ black, fill=color1 \\ black, fill=color5 \\ black, fill=color9 \\ black, fill=color8 \\ black, fill=color4 \\}}
    
    \addplot table[x=alg, y expr=(\thisrow{genOmegaTime})] {\datafile};
     \addplot table[x=alg, y expr=(\thisrow{dgemm1Time})] {\datafile};
    \addplot table[x=alg, y expr=(\thisrow{all2allTime})] {\datafile};
    \addplot table[x=alg, y expr=(\thisrow{unpackTime})] {\datafile};
     \addplot table[x=alg, y expr=(\thisrow{dgemm2Time})] {\datafile};
      \addplot table[x=alg, y expr=(\thisrow{reduceScatterTime})] {\datafile};
    
    \iflegend
    	\legend{Generate B,  1st MatMul , All2All, Unpack, 2nd MatMul, ReduceScatter};
    \fi
  \end{axis}
\end{tikzpicture}

%alg,totalTime,genOmegaTime,dgemm1Time,dgemm2Time,all2allTime,reduceScatterTime,reduceScatter1Time,reduceScatter2Time,unpackTime,packTime
